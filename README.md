Бот нужен чтобы скачать видео из Instagram или YouTube и отправить в Telegram как вложение. Работает с постами и Reels. Изображения не поддерживаются.

Требования:
- Python-пакеты: `python-telegram-bot`, `yt-dlp` (см. `requirements.txt`)
- В системе должен быть установлен `ffmpeg`
  - Ubuntu/Debian: `apt install ffmpeg`

Куки для загрузки:
- Для Instagram: файл `cookie_instagram.txt` (не хранить в репозитории)
- Для YouTube: файл `cookie_youtube.txt` (не хранить в репозитории)

Как получить cookie (и где хранить):
1. Войти в аккаунт в браузере.
2. Установить расширение «Get cookies.txt LOCALLY».
3. Сохранить куки в локальные файлы (`cookie_instagram.txt` и/или `cookie_youtube.txt`) рядом с проектом или в папке `secrets/`.
4. Не коммитить эти файлы в репозиторий — они добавлены в `.gitignore`.

Запуск бота
1) Переменные окружения:
- `BOT_TOKEN` — токен Telegram-бота от BotFather.
- `ALLOWED_USER_IDS` — список ID пользователей, которым разрешён доступ (через запятую). Примеры: `12345` или `12345,67890`.
  - Пробелы и пустые элементы игнорируются, некорректные значения пропускаются.

2) Docker (рекомендуется примонтировать cookie как read-only):
```
docker run -d \
  -e BOT_TOKEN=your_token_here \
  -e ALLOWED_USER_IDS=123456789,1234567449 \
  -v $(pwd)/cookie_instagram.txt:/app/cookie_instagram.txt:ro \
  -v $(pwd)/cookie_youtube.txt:/app/cookie_youtube.txt:ro \
  your-image-name
```

Использование
- Отправьте боту ссылку на видео из Instagram или YouTube — бот скачает и пришлёт его как видео.
- Если размер файла больше 50 МБ, бот автоматически пережмёт видео (до ширины ~640px), чтобы уложиться в лимит Telegram.
- Кнопка «Статистика» и команда `/stats` показывают суммарные значения за время работы контейнера: успешные и неуспешные загрузки.
- Для Instagram бот использует мобильный User-Agent и делает несколько автоматических повторов при временных ошибках/лимитах.
- Бот ведёт «комментарий состояния»: одно служебное сообщение обновляется на каждом этапе (скачивание с процентами/повторы/перекодирование/отправка) и показывает текущую статистику (успехи/ошибки с момента запуска).

Примечания
- Статистика хранится в памяти процесса и сбрасывается при перезапуске контейнера.

Безопасность
- Файлы cookie и токены не должны попадать в репозиторий. В репозитории добавлен `.gitignore`, закрывающий `cookie_*.txt`, `secrets/` и локальные артефакты.
- Cookie-файлы опциональны для публичных видео, но часто нужны для приватных/ограниченных материалов.
 - Instagram может временно требовать авторизацию или ограничивать частоту запросов. Если ошибка повторяется, обновите `cookie_instagram.txt` и попробуйте позже.
