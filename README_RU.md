Бот для скачивания видео из Instagram/YouTube и аудио по названию песни или ссылке из Spotify.

- **Видео**: Принимает ссылки на посты, Reels, Shorts.
- **Аудио**: Принимает текстовое название песни (например, `Daft Punk - Around the World`) или ссылку на трек из Spotify.

English version: see README_EN.md

### Требования
- Python-пакеты: `python-telegram-bot`, `yt-dlp`, `spotipy` (см. `requirements.txt`)
- В системе должен быть установлен `ffmpeg`
  - Ubuntu/Debian: `apt install ffmpeg`

### Куки для загрузки
- Для Instagram: файл `cookie_instagram.txt`
- Для YouTube: файл `cookie_youtube.txt`

Как получить cookie:
1. Войти в аккаунт в браузере.
2. Установить расширение «Get cookies.txt LOCALLY».
3. Сохранить куки в локальные файлы (`cookie_instagram.txt`, `cookie_youtube.txt`).
4. Не коммитить эти файлы в репозиторий — они добавлены в `.gitignore`.

### Запуск бота
#### 1) Переменные окружения
Создайте файл `.env` в корне проекта или экспортируйте переменные:

- `BOT_TOKEN` — токен Telegram-бота от BotFather.
- `ALLOWED_USER_IDS` — список ID пользователей, которым разрешён доступ (через запятую).
- `SPOTIPY_CLIENT_ID` — (Опционально) Client ID вашего приложения Spotify.
- `SPOTIPY_CLIENT_SECRET` — (Опционально) Client Secret вашего приложения Spotify.

> **Где взять ключи Spotify?**
> 1. Зайдите на [Spotify Developer Dashboard](https://developer.spotify.com/dashboard).
> 2. Создайте новое приложение (Create an app).
> 3. Скопируйте `Client ID` и `Client Secret` из настроек вашего приложения.
> 4. Добавьте их в ваш `.env` файл.
> *Без этих ключей будет работать только поиск по названию, но не по ссылкам на Spotify.*

#### 2) Docker (рекомендуемый способ)
Пример команды для запуска через `docker-compose` (предпочтительно, так как он автоматически подхватит `.env` файл):
```bash
docker-compose up -d --build
```
`docker-compose.yml` уже настроен для использования этих переменных.

### Использование
- **Для скачивания видео**: Отправьте боту ссылку на видео из Instagram или YouTube.
- **Для скачивания аудио**: Отправьте боту название песни (например, `Queen - Bohemian Rhapsody`) или ссылку на трек из Spotify.
- Бот интеллектуально определяет тип запроса по содержимому сообщения.
- Если видеофайл превышает 50 МБ, он будет автоматически сжат.
- Команда `/stats` показывает статистику успешных и неуспешных загрузок.
- Бот обновляет одно сообщение, показывая текущий статус (поиск, скачивание, загрузка).

### Безопасность
- Файлы cookie, `.env` и токены не должны попадать в репозиторий. `.gitignore` настроен для их игнорирования.
- Cookie-файлы опциональны для публичных видео, но часто нужны для приватных/ограниченных материалов.
